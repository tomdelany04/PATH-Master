---
title: Predictive Approaches to Treatment Effect Heterogeneity
author:
  - name: Tom Delany
  - name: Misgana Ojamo
    affil: 1
affiliation:
  - num: 1
    address: School of Mathematical and Statistical Sciences, University of Galway
logoleft_name: https&#58;//sport.universityofgalway.ie/assets/img/logo2.png

poster_height: "594mm"
poster_width: "841mm"
column_numbers: 4
column_margins: "0.5in"	
primary_colour:	"#a80050"	# Secondary colour use for poster design.
secondary_colour:	"#84003d"	# Main colour used for poster design.
accent_colour:	"#e6007e"	# A third colour option.
author_textcol: "white"
title_textsize: "60pt"
author_textsize: "38pt"
body_textsize: "20pt"
output: 
  posterdown::posterdown_html:
    self_contained: false
    pandoc_args: --mathjax
    number_sections: false
knit: pagedown::chrome_print
---

```{css, echo=FALSE}
div.logo_left{
  width: 20%;
}
div.poster_title{
  width: 80%;
}
.section h4 {
    break-after: column;
}
div.footnotes {
    font-size: 18pt;
}
```

<!-- Don't change anything above, except the title and author names, unless you know what you are doing. -->

# Background

<!-- You can add references by inserting the following ^[reference details here] -->

• Clinical trials typically report average treatment effects This assumes homgenous patient response and ignores patients differences in demographics, disease severity, and behaviors - termed patient **Heterogeneity (HTE)** [^1], crucially, these factors may modify the effectiveness of treatment.

• Traditional **subgroup analyses** attempt to address HTE by examining one variable at a time (e.g Male vs Female). However, these analyses are frequently underpowered, suffer from high rates of false positives and miss multivariate treatment response patterns.

• **Predictive Approaches to Treatment effect Heterogeneity (PATH)** shift the focus to individualized prediction, modelling risk and treatment effects across individuals [^2].

[^1]: Kent et al. 2020, doi: 10.7326/M18-3668
[^2]: Willke et al. 2012, doi: 10.1186/1471-2288-12-185

### Objectives:

1.  Implement and evaluate predictive HTE models across multiple clinical datasets
2.  Assess the clinical relevance and reporting implications of PATH analyses

# Data Sources
Analyses are based on published clinical trial data from the GUSTO-I trial (GUSTO) [^3] and the Digitalis Investigation Group trial (DIG) [^4]. The Characteristics of each trial are described below.

[^3]: The GUSTO investigators, 1993, doi: 10.1056/NEJM199309023291001
[^4]: The Digitalis Investigation Group, Feb. 1997, doi: 10.1056/NEJM199702203360801

```{r, echo = FALSE, message = FALSE, warning = FALSE}
library(table1)
library(metafor)
library(Hmisc)
library(splines)
library(dplyr)
library(gtsummary)
library(gt)
library(xfun)
library(patchwork)
```



```{r, echo = F, message = FALSE, warning = FALSE}
trial_summary <- data.frame(
Characteristic = c("Patients (n)", "Treatments", "Years ran", "Design", "Follow-up", "Location", "Primary outcome"),
`GUSTO` = c("41,021", "Accelerated tPA vs Streptokinase (± heparin)", "1989–1993", "Open-Label", "30 days", "International - 15 Countries", "30-day mortality"),
`DIG` = c("6,800", "Digoxin vs Placebo", "1991–1995", "Double-blind, placebo-controlled", "37 Months (mean)", "USA - 302 Centres", "All-cause mortality")
)


trial_summary %>%
gt() %>%
tab_header("Overview of GUSTO and DIG trials") %>% 
  
tab_style(style = cell_text(size = px(28), weight = "bold", color = "#84003d"),
locations = cells_title(groups = "title")) %>%
  
tab_options(
  
table.border.top.color = "#84003d",
table.border.bottom.color = "#84003d",
table.border.left.color = "#84003d",
table.border.right.color = "#84003d",

table.border.bottom.width = px(3),
table.border.top.width = px(3),
table.border.left.width = px(3),
table.border.right.width = px(3),

table_body.hlines.color = "#84003d",
table_body.vlines.color = "#84003d",

column_labels.border.bottom.color = "#84003d",

data_row.padding = px(11), 
column_labels.padding = px(10)

) %>% tab_style(
style = cell_borders(sides = "right", color = "#84003d", weight = px(2)),
locations = cells_body(columns = "GUSTO")
) %>%
tab_style(
style = cell_borders(sides = "right", color = "#84003d", weight = px(2)),
locations = cells_column_labels(columns = "GUSTO")
) %>% 
tab_style(
style = cell_borders(sides = "right", color = "#84003d", weight = px(2)),
locations = cells_body(columns = "Characteristic")
) %>%
tab_style(
style = cell_borders(sides = "right", color = "#84003d", weight = px(2)),
locations = cells_column_labels(columns = "Characteristic")
) %>%

tab_style(
style = cell_text(size = px(22), color = "black"),
locations = cells_body(everything())
) %>%

tab_style(
style = cell_text(size = px(22), color = "black", weight = "bold"),
locations = cells_column_labels(everything())
)






```

<!-- This #### below causes the columns to break -->

<!-- You can change where you put these breaks, and the "column_numbers: 4" argument in the YAMLS header to change the layout of the poster, with care! -->

#### 


# Early Results


```{r fig-table1, fig.cap="Key subgroups and their characteristics for DIG and GUSTO. MI - Myocardial Infarction, NYHA - New York Heart Association", echo = F, message = FALSE, warning = FALSE, out.width='100%', fig.align = "center"}
#Gusto table (Create table - Make gt - Change styling)


knitr::include_graphics("combined.png")


```

To evaluate how our effects stratified by baseline risk compare with effects observed in traditional subgroups, we generated the following forest plots for the DIG and GUSTO trials.


```{r DIG-fig-forest, echo=FALSE, message = FALSE, warning = FALSE, fig.cap="DIG- Trial, Forest plot of treatment heterogeneity. Points represent odds ratios and horizontal lines indicate 95% confidence intervals; the vertical line denotes no effect (OR = 1).", out.width="100%", fig.align="center"}

res <- readRDS("dig_forest_baseline_risk_model.rds")

par(mar=c(2.5,4,1,2))
par(fg="#84003d")

forest(res, xlim=c(-1.2,0.8),
       at=log(c(0.5, 1, 2)),
       alim=c(log(0.2), log(2)),
       atransf=exp,
       adj=1,
       cex=.95, ylim=c(0,22),
       rows=c(1:2, (4:5)-.5, 6:7, 10:13, 15),
       xlab="", mlab="", psize=1.8, lwd=2, addfit=FALSE,
       col="#84003d",
       shade=FALSE)

text(-1.2, 18, "DIG Trial", font=2, adj=0, cex=1)
text(0.8,  18, "OR [95% CI]", font=2, adj=1, cex=1)

```

```{r fig-forest, echo=FALSE, message = FALSE, warning = FALSE, fig.cap="Forest plot of treatment heterogeneity. Points represent odds ratios and horizontal lines indicate 95% confidence intervals; the vertical line denotes no effect (OR = 1).", out.width="100%", fig.align="center"}

# loading saved rds
pack <- readRDS("gusto_forest_pack.rds")

data.subgroups <- pack$data_subgroups
res <- pack$res

par(mar=c(2.5,4,1,2))
par(fg="#84003d")


forest(res, 
       xlim=c(-1.2,0.8), 
       at=log(c(0.5, 1)), 
       alim=c(log(0.2), log(2)), 
       atransf=exp,
       adj=1,
       cex=.95, ylim=c(0, 22),
       rows=c(1:2, (4:5)-.5, 6:7, 10:13, 15),
       xlab="", mlab="", psize=1.8, lwd = 2, addfit=F,
       col = "#84003d", 
       shade = F)

text(.8, 18, "OR [95% CI]", font=2, adj=1, cex=1)


text(-1.2, 18, "GUSTO-I trial", font=2, adj=0, cex=1)


```


```{r fig-proportional, echo=FALSE, message = FALSE, warning= FALSE, fig.cap="Absolute treatment benefit increases with baseline risk (GUSTO). The solid maroon curve shows the expected absolute risk reduction under a proportional treatment effect model, illustrating increasing benefit with higher baseline risk. Blue points show observed absolute risk reductions within risk-based subgroups, with 95% confidence intervals.", out.width="100%", fig.align="center"}

pack2 <- readRDS("gusto_benefit_pack.rds")


par(mar=c(4,4,1,2))
par(fg="#84003d")


plot(x = pack2$xp, y = pack2$p1exp,
type="l", lty=1, lwd=4,
xlim=c(0,.35), ylim=c(-0.007,.05),
col="#84003d",
xlab="Baseline risk", ylab="Benefit by tPA",
cex.lab=1.2, las=1, bty="l")


lines(x=c(0,.5), y=c(0,0), col="#84003d")


histSpike(plogis(pack2$lp_no_tx), add=TRUE, side=1, nint=300, frac=.15)


points(x=pack2$rate0, y=pack2$ratediff, pch=1, cex=1.5, lwd=2, col="blue")
arrows(x0=pack2$rate0, x1=pack2$rate0,
y0=pack2$CI[,2], y1=pack2$CI[,3],
angle=90, code=3, len=.1, col="blue")


legend("topleft",
lty=c(1, NA), pch=c(NA, 1), lwd=c(3, 2),
bty="n", col=c("#84003d", "blue"), cex=1.2,
legend=c("Expected with proportional effect", "Grouped patients"))


```


```{r fig-proportional, echo=FALSE, message = FALSE, warning= FALSE, fig.cap="Absolute treatment benefit by baseline risk. The dashed maroon line represents the expected absolute benefit under a proportional treatment effect model, assuming a constant relative effect across baseline risk. Blue points show observed absolute risk differences within baseline-risk strata, with vertical bars indicating 95% confidence intervals.The histogram along the x-axis displays the distribution of baseline risk in the study population.", out.width="100%", fig.align="center"}

library(Hmisc)      
library(DescTools)  

par(mar=c(5,5,2,2))
par(fg="#84003d")
plot(x = xp, y = p1exp,
     type = "l", lty = 1, lwd = 3, col = "maroon",
     xlim = c(0.15, 0.8), ylim = c(min(-0.01, min(ci_low, na.rm=TRUE)), 0.25),
     xlab = "Baseline risk", ylab = "Benefit by Digoxin",
     cex.lab = 1.2, las = 1, bty = "l")

# zero line
abline(h=0, col = "grey", lwd = 1)

lines(xp, p1exp, lty=2, lwd=3, col = "maroon")


# spike histogram along x-axis
histSpike(baseline_risk_dist, add = TRUE, side = 1, nint = 300, frac = 0.15, col= "maroon")

# grouped patients (quartiles): x = placebo risk in quartile, y = ARR
points(x = as.numeric(rate0), y = as.numeric(ratediff),
       pch = 1, cex = 1.5, lwd = 2, col = "blue")

# CI bars
arrows(x0 = as.numeric(rate0), x1 = as.numeric(rate0),
       y0 = as.numeric(ci_low), y1 = as.numeric(ci_up),
       angle = 90, code = 3, len = 0.08, col = "blue")


legend("topleft",
       lty = c(1, NA), pch = c(NA, 1),
       lwd = c(3, 2), bty = "n",
       col = c("maroon", "blue"), cex = 1.1,
       legend = c("Expected with proportional effect", "Grouped patients"))


# Save for poster use
saveRDS(res, file = "dig_baseline_Vs_risk_plot.rds")


```


#### 

# Next Steps

We will conduct further analyses on the International Stroke Trial (IST) [^5] and the National Lung screening Trial (NLST) [^6], to evaluate the applicability of PATH across domains. We also plan to implement a machine-learning approach using causal forests for patient risk prediction. We will use the `grf` package for this.

```{r, echo = F, message = FALSE, warning = FALSE}

trial_summary2 <- data.frame(
Characteristic = c("Patients (n)", "Treatments", "Years ran", "Design", "Follow-up", "Location", "Primary outcome"),
`IST` = c("19,435", "Factorial (± Heparin ± Aspirin)", "1991–1996", "Open-Label", "14 days (early outcomes); 6 months (main)", "International - 36 Countries", "14-day and 6 month mortality"),
`NLST` = c("53,254", "CT screening vs. chest radiography", "2002-2009", "Randomized controlled trial", "Median 6.5 years", "USA - 33 centres", "Lung-cancer mortality")
)


trial_summary2 %>%
gt() %>%
tab_header("Overview of IST and NLST trials") %>% 
  
tab_style(style = cell_text(size = px(28), weight = "bold", color = "#84003d"),
locations = cells_title(groups = "title")) %>%
  
tab_options(
  
table.border.top.color = "#84003d",
table.border.bottom.color = "#84003d",
table.border.left.color = "#84003d",
table.border.right.color = "#84003d",

table.border.bottom.width = px(3),
table.border.top.width = px(3),
table.border.left.width = px(3),
table.border.right.width = px(3),

table_body.hlines.color = "#84003d",
table_body.vlines.color = "#84003d",

column_labels.border.bottom.color = "#84003d",

data_row.padding = px(10), 
column_labels.padding = px(10)

) %>% tab_style(
style = cell_borders(sides = "right", color = "#84003d", weight = px(2)),
locations = cells_body(columns = "IST")
) %>%
tab_style(
style = cell_borders(sides = "right", color = "#84003d", weight = px(2)),
locations = cells_column_labels(columns = "IST")
) %>% tab_style(
style = cell_borders(sides = "right", color = "#84003d", weight = px(2)),
locations = cells_body(columns = "Characteristic")
) %>%
tab_style(
style = cell_borders(sides = "right", color = "#84003d", weight = px(2)),
locations = cells_column_labels(columns = "Characteristic")
) %>%

tab_style(
style = cell_text(size = px(22), color = "black"),
locations = cells_body(everything())
) %>%

tab_style(
style = cell_text(size = px(22), color = "black", weight = "bold"),
locations = cells_column_labels(everything())
)

```
[^5]: Sandercock et al., 2011, doi: 10.1186/1745-6215-12-101
[^6]: The National Lung Screening Trial Research Team, 2011, doi: 10.1056/NEJMoa1102873

# GitHub

The code and datasets for this project can be viewed at our GitHub repository here: <https://github.com/tomdelany04/PATH-Master/>

# References


