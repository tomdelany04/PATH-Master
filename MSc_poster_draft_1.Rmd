---
title: Predictive Approaches to Treatment Effect Heterogeneity
author:
  - name: Tom Delany
  - name: Misgana Ojamo
    affil: 1
affiliation:
  - num: 1
    address: School of Mathematical and Statistical Sciences, University of Galway
logoleft_name: https&#58;//sport.universityofgalway.ie/assets/img/logo2.png

poster_height: "594mm"
poster_width: "841mm"
column_numbers: 4
column_margins: "0.5in"	
primary_colour:	"#a80050"	# Secondary colour use for poster design.
secondary_colour:	"#84003d"	# Main colour used for poster design.
accent_colour:	"#e6007e"	# A third colour option.
author_textcol: "white"
title_textsize: "60pt"
author_textsize: "40pt"
body_textsize: "20pt"
output: 
  posterdown::posterdown_html:
    self_contained: false
    pandoc_args: --mathjax
    number_sections: false
knit: pagedown::chrome_print
---

```{css, echo=FALSE}
div.logo_left{
  width: 20%;
}
div.poster_title{
  width: 80%;
}
.section h4 {
    break-after: column;
}
div.footnotes {
    font-size: 18pt;
}
```

<!-- Don't change anything above, except the title and author names, unless you know what you are doing. -->

# Background

<!-- You can add references by inserting the following ^[reference details here] -->

• Relying on average trial effects ignores that patients differ in demographics, disease severity, and behaviors - termed patient Heterogeneity (HTE) [^1], crucially, these factors may modify the effectiveness of treatment.

• Traditional subgroup analyses (one variable at a time) have low power, high false positives, and aren’t truly patient-centred.

• Predictive Approaches to Treatment effect Heterogeneity (PATH) model risk and treatment effects to estimate individual patient outcomes across treatments [^2].

[^1]: Kent et al. 2020, doi: 10.7326/M18-3668
[^2]: Willke et al. 2012, doi: 10.1186/1471-2288-12-185

## Objectives

1.  Implement and evaluate predictive HTE models across multiple clinical datasets
2.  Compare risk-based and effects-based approaches in practice
3.  Assess the clinical relevance and reporting implications of PATH analyses

# Data Sources
Analyses are based on published clinical trial data from the GUSTO-I trial (GUSTO) [^3] and the Digitalis Investigation Group trial (DIG) [^4]. 

[^3]: The GUSTO investigators, 1993, doi: 10.1056/NEJM199309023291001
[^4]: The Digitalis Investigation Group, Feb. 1997, doi: 10.1056/NEJM199702203360801

```{r, echo = FALSE, message = FALSE, warning = FALSE}
library(table1)
library(metafor)
library(Hmisc)
library(splines)
library(dplyr)
library(gtsummary)
library(gt)
```



```{r, echo = F, message = FALSE, warning = FALSE}
trial_summary <- data.frame(
Characteristic = c("Patients (n)", "Treatments", "Years ran", "Design", "Follow-up", "Location", "Primary outcome"),
`GUSTO` = c(41021, "Accelerated tPA vs Streptokinase (± heparin)", "1989–1993", "Open-Label", "30 days", "International - 15 Countries", "30-day mortality"),
`DIG` = c(6800, "Digoxin vs Placebo", "1991–1995", "Double-blind, placebo-controlled", "37 Months (mean)", "USA - 302 Centres", "All-cause mortality")
)


trial_summary %>%
gt() %>%
tab_header("Overview of GUSTO and DIG trials") %>% 
  
tab_style(style = cell_text(size = px(28), weight = "bold", color = "#84003d"),
locations = cells_title(groups = "title")) %>%
  
tab_options(
  
table.border.top.color = "#84003d",
table.border.bottom.color = "#84003d",
table.border.left.color = "#84003d",
table.border.right.color = "#84003d",

table.border.bottom.width = px(3),
table.border.top.width = px(3),
table.border.left.width = px(3),
table.border.right.width = px(3),

table_body.hlines.color = "#84003d",
table_body.vlines.color = "#84003d",

column_labels.border.bottom.color = "#84003d",

data_row.padding = px(16), 
column_labels.padding = px(14)

) %>% tab_style(
style = cell_borders(sides = "right", color = "#84003d", weight = px(2)),
locations = cells_body(columns = "GUSTO")
) %>%
tab_style(
style = cell_borders(sides = "right", color = "#84003d", weight = px(2)),
locations = cells_column_labels(columns = "GUSTO")
) %>% 
tab_style(
style = cell_borders(sides = "right", color = "#84003d", weight = px(2)),
locations = cells_body(columns = "Characteristic")
) %>%
tab_style(
style = cell_borders(sides = "right", color = "#84003d", weight = px(2)),
locations = cells_column_labels(columns = "Characteristic")
) %>%

tab_style(
style = cell_text(size = px(18), color = "black"),
locations = cells_body(everything())
) %>%

tab_style(
style = cell_text(size = px(20), color = "black", weight = "bold"),
locations = cells_column_labels(everything())
)






```

<!-- This #### below causes the columns to break -->

<!-- You can change where you put these breaks, and the "column_numbers: 4" argument in the YAMLS header to change the layout of the poster, with care! -->

#### 


# Early Results


```{r fig-descriptive_table_gusto, echo = F, message = FALSE, warning = FALSE, out.width='80%'}

gusto_prep <- readRDS("gusto_prep.rds")


gusto_tab1_overall <- table1(~ age + miloc + sex, data = gusto_prep)
gusto_tab1_overall

dig <- read.csv("DIG.csv")   
dig_raw <- dig                                   

dig.df <- dig %>%
  select(TRTMT, AGE, EJF_PER, FUNCTCLS, DEATH, SYSBP, HEARTRTE, PREVMI) %>%
  mutate(
    TRTMT = factor(TRTMT, levels = c(0, 1), labels = c("Placebo", "Digoxin")),
    DEATH = factor(DEATH, levels = c(0, 1), labels = c("Alive", "Dead")),
    DEATHn = as.integer(DEATH == "Dead"),
    Digoxin = as.integer(TRTMT == "Digoxin"),
    Classification = factor(
      FUNCTCLS, levels = c(1, 2, 3, 4),
      labels = c("NYHA_1", "NYHA_2", "NYHA_3", "NYHA_4")
    ),
    Ejection_Fraction = EJF_PER,
    sysbp_maxed = pmin(SYSBP, 120)
  )

# Early results
dig_tab1 <- table1(
  ~ AGE + Ejection_Fraction + Classification,
  data = dig.df, digits = 2
)

dig_tab1



```




```{r DIG-fig-forest, echo=FALSE, message = FALSE, warning = FALSE, fig.cap="DIG- Trial, Forest plot of treatment heterogeneity", out.width="100%", fig.align="center"}

res <- readRDS("dig_forest_baseline_risk_model.rds")

par(mar=c(4,4,1,2))
par(fg="#84003d")

forest(res, xlim=c(-1.2,0.8),
       at=log(c(0.5, 1, 2)),
       alim=c(log(0.2), log(2)),
       atransf=exp,
       adj=1,
       cex=.9, ylim=c(0,22),
       rows=c(1:2, (4:5)-.5, 6:7, 10:13, 15),
       xlab="", mlab="", psize=1, lwd=1.5, addfit=FALSE,
       col="#84003d",
       shade=FALSE)

text(-1.2, 18, "DIG Trial", font=2, adj=0, cex=.9)
text(0.8,  18, "OR [95% CI]", font=2, adj=1, cex=.9)

```

DIG trial forest plot showing treatment-effect heterogeneity across baseline risk strata and key prognostic subgroups (ejection fraction, age, NYHA class, and risk quartiles). Points represent odds ratios and horizontal lines indicate 95% confidence intervals; the vertical line denotes no effect (OR = 1).

```{r fig-forest, echo=FALSE, message = FALSE, warning = FALSE, fig.cap="Forest plot of treatment heterogeneity", out.width="100%", fig.align="center"}

# loading saved rds
pack <- readRDS("gusto_forest_pack.rds")

data.subgroups <- pack$data_subgroups
res <- pack$res

par(mar=c(4,4,1,2))
par(fg="#84003d")


forest(res, 
       xlim=c(-1.2,0.8), 
       at=log(c(0.5, 1)), 
       alim=c(log(0.2), log(2)), 
       atransf=exp,
       adj=1,
       cex=.9, ylim=c(0, 22),
       rows=c(1:2, (4:5)-.5, 6:7, 10:13, 15),
       xlab="", mlab="", psize=1, lwd = 1.5, addfit=F,
       col = "#84003d",
       shade = F)

# Right-side OR header (pulled left)
text(.8, 18, "OR [95% CI]", font=2, adj=1, cex=.9)


# Left-side title (pulled right)
text(-1.2, 18, "GUSTO-I trial", font=2, adj=0, cex=.9)


```


Above is a Forest Plot which display the PATH (risk-based) subgroups alongside traditional subgroups (Age, Sex, Location of MI). Low risk according to the linear predictor (lp<-2.36) implies low benefit (<1%); higher risk, higher benefit (>2%).

```{r fig-proportional, echo=FALSE, message = FALSE, warning= FALSE, fig.cap="Absolute treatment benefit increases with baseline risk", out.width="100%", fig.align="center"}

pack2 <- readRDS("gusto_benefit_pack.rds")


par(mar=c(4,4,1,2))
par(fg="#84003d")


plot(x = pack2$xp, y = pack2$p1exp,
type="l", lty=1, lwd=4,
xlim=c(0,.35), ylim=c(-0.007,.05),
col="#84003d",
xlab="Baseline risk", ylab="Benefit by tPA",
cex.lab=1.2, las=1, bty="l")


lines(x=c(0,.5), y=c(0,0), col="#84003d")


histSpike(plogis(pack2$lp_no_tx), add=TRUE, side=1, nint=300, frac=.15)


points(x=pack2$rate0, y=pack2$ratediff, pch=1, cex=1.5, lwd=2, col="blue")
arrows(x0=pack2$rate0, x1=pack2$rate0,
y0=pack2$CI[,2], y1=pack2$CI[,3],
angle=90, code=3, len=.1, col="blue")


legend("topleft",
lty=c(2, NA), pch=c(NA, 1), lwd=c(3, 2),
bty="n", col=c("#84003d", "blue"), cex=1.2,
legend=c("Expected with proportional effect", "Grouped patients"))


```

The solid maroon curve shows the expected absolute risk reduction under a proportional treatment effect model, illustrating increasing benefit with higher baseline risk. Blue points show observed absolute risk reductions within risk-based subgroups, with 95% confidence intervals.


#### 

# Next Steps

We plan to conduct further analysis on the International Stroke Trial (IST) [^5] and the National Lung screening Trial (NLST) [^6], to evaluate the generalizability of PATH across domains (Table 2). We also plan to implement a machine-learning approach using causal forests for patient risk prediction. We will use the `grf` package for this.

```{r, echo = F, message = FALSE, warning = FALSE}
trial_summary <- data.frame(
Characteristic = c("Patients (n)", "Treatments", "Years ran", "Design", "Follow-up", "Location", "Primary outcome"),
`IST` = c(19435, "Factorial (± Heparin ± Aspirin)", "1991–1996", "Open-Label", "14 days (early outcomes); 6 months (main)", "International - 36 Countries", "14-day and 6 month mortality"),
`NLST` = c(53254, "CT screening vs. chest radiography", "2002-2009", "Randomized controlled trial", "Median 6.5 years", "USA - 33 centres", "Lung-cancer mortality")
)


trial_summary %>%
gt() %>%
tab_header("Overview of IST and NLST trials") %>% 
  
tab_style(style = cell_text(size = px(28), weight = "bold", color = "#84003d"),
locations = cells_title(groups = "title")) %>%
  
tab_options(
  
table.border.top.color = "#84003d",
table.border.bottom.color = "#84003d",
table.border.left.color = "#84003d",
table.border.right.color = "#84003d",

table.border.bottom.width = px(3),
table.border.top.width = px(3),
table.border.left.width = px(3),
table.border.right.width = px(3),

table_body.hlines.color = "#84003d",
table_body.vlines.color = "#84003d",

column_labels.border.bottom.color = "#84003d",


data_row.padding = px(16), 
column_labels.padding = px(14)

) %>% tab_style(
style = cell_borders(sides = "right", color = "#84003d", weight = px(2)),
locations = cells_body(columns = "IST")
) %>%
tab_style(
style = cell_borders(sides = "right", color = "#84003d", weight = px(2)),
locations = cells_column_labels(columns = "IST")
) %>% tab_style(
style = cell_borders(sides = "right", color = "#84003d", weight = px(2)),
locations = cells_body(columns = "Characteristic")
) %>%
tab_style(
style = cell_borders(sides = "right", color = "#84003d", weight = px(2)),
locations = cells_column_labels(columns = "Characteristic")
) %>%


tab_style(
style = cell_text(size = px(18), color = "black"),
locations = cells_body(everything())
) %>%

tab_style(
style = cell_text(size = px(20), color = "black", weight = "bold"),
locations = cells_column_labels(everything())
)






```

[^5]: Sandercock et al., 2011, doi: 10.1186/1745-6215-12-101
[^6]: The National Lung Screening Trial Research Team, 2011, doi: 10.1056/NEJMoa1102873

# GitHub

The code and datasets for this project can be viewed at our GitHub repository here: <https://github.com/tomdelany04/PATH-Master/>


# References


